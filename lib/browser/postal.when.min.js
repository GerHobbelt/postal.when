(function(a,b,c){typeof define=="function"&&define.amd?define(["underscore","postal"],function(d,e){return c(d,e,a,b)}):c(a._,a.postal,a,b)})(this,document,function(a,b,c,d,e){var f=function(c,d,f,g){var h=this,i=Object.prototype.toString.call(f)==="[object Function]"?f:function(){},j=Object.prototype.toString.call(f)==="[object Object]"?f:g||{},k=[],l,m=function(){j.timeout&&(l=setTimeout(function(){i({type:"timeout",data:a.pluck(k,"data")})},j.timeout))},n=function(){a.each(k,function(a){a.data=e})},o=function(){var b=a.pluck(k,"data"),c;a.all(b,a.identity)&&(clearTimeout(l),d.apply(this,b),j.once?h.dispose():(n(),m()))};h.dispose=function(){a.each(k,function(a){a.unsubscribe()}),k=[]},a.each(c,function(a){var c=b.subscribe(a);c.data=e,c.subscribe(function(a){c.data=a,o()}),k.push(c)}),m()};b.when=function(a,b,c,d){return new f(a,b,c,d)}})