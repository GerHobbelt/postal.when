(function(a,b,c){typeof define=="function"&&define.amd?define(["underscore","postal"],function(d,e){return c(d,e,a,b)}):c(a._,a.postal,a,b)})(this,document,function(a,b,c,d,e){var f=function(c,d,f){var g=this,h=[],i=function(){a.each(h,function(a){a.data=e})},j=f||{},k=function(){var b=a.pluck(h,"data"),c;a.all(b,a.identity)&&(d.apply(this,b),j.once?g.dispose():i())};g.dispose=function(){a.each(h,function(a){a.unsubscribe()}),h=[]},a.each(c,function(a){var c=b.subscribe(a);c.data=e,c.subscribe(function(a){c.data=a,k()}),h.push(c)})};b.when=function(a,b){return new f(a,b)}})